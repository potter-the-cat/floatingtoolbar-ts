!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.FloatingToolbar=e():t.FloatingToolbar=e()}(this,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(){this.elements.toolbar&&(this.state.isFixed?this.elements.toolbar.classList.add("visible"):this.elements.toolbar.classList.toggle("visible",this.state.isVisible),"initial"===this.state.currentView?(this.elements.toolbarInitial&&(this.elements.toolbarInitial.style.display="flex"),this.elements.toolbarLinkInput&&(this.elements.toolbarLinkInput.classList.remove("active"),this.elements.toolbarLinkInput.style.display="none",this.elements.linkInput&&(this.elements.linkInput.disabled=!1,this.elements.linkInput.style.pointerEvents="auto"))):"linkInput"===this.state.currentView&&this.elements.toolbarLinkInput&&(this.elements.toolbarInitial&&(this.elements.toolbarInitial.style.display="none"),this.elements.toolbarLinkInput&&(this.elements.toolbarLinkInput.classList.add("active"),this.elements.toolbarLinkInput.style.display="flex",this.elements.linkInput&&(this.elements.linkInput.disabled=!1,this.elements.linkInput.style.pointerEvents="auto",setTimeout((()=>{this.elements.linkInput&&this.elements.linkInput.focus()}),50)),this.elements.removeLink&&(this.elements.removeLink.style.display=this.state.existingLink?"flex":"none"),this.elements.linkInput&&this.elements.visitLink&&this.updateVisitButton(this.elements.linkInput.value.trim()))),(this.state.isVisible||this.state.isFixed)&&this.updatePosition())}function o(){this.addToolbarStyles(),this.elements=function(t,e){const n=t.useExistingToolbar?"":`${t.toolbarId}-`,o={toolbar:document.getElementById(t.toolbarId),toolbarInitial:null,toolbarLinkInput:null,linkButton:null,linkInput:null,saveLink:null,cancelLink:null,removeLink:null,visitLink:null,boldButton:null,italicButton:null,underlineButton:null,strikethroughButton:null,subscriptButton:null,superscriptButton:null,h1Button:null,h2Button:null,dropCapButton:null,codeButton:null,quoteButton:null,hrButton:null,bulletListButton:null,numberListButton:null};return o.toolbar?(o.toolbarInitial=o.toolbar.querySelector(".toolbar-initial"),o.toolbarLinkInput=o.toolbar.querySelector(".toolbar-link-input"),Object.entries({linkButton:"link-button",linkInput:"link-input",saveLink:"save-link",cancelLink:"cancel-link",removeLink:"remove-link",visitLink:"visit-link",boldButton:"bold-button",italicButton:"italic-button",underlineButton:"underline-button",strikethroughButton:"strikethrough-button",subscriptButton:"subscript-button",superscriptButton:"superscript-button",h1Button:"h1-button",h2Button:"h2-button",dropCapButton:"drop-cap-button",codeButton:"code-button",quoteButton:"quote-button",hrButton:"hr-button",bulletListButton:"bullet-list-button",numberListButton:"number-list-button"}).forEach((([i,s])=>{const l=`${n}${s}`,a=document.getElementById(l);o[i]=a,!a&&t.debug&&e(`Element with ID "${l}" not found`)})),o):(console.error(`FloatingToolbar: Toolbar element with ID "${t.toolbarId}" not found`),o)}(this.config,this.debug.bind(this)),function(t,e,n,o){const i=document.querySelector(t.selector||"");if(!i)return;let s=!1;i.addEventListener("focus",(()=>{document.querySelectorAll(".floating-toolbar").forEach((t=>{t!==n.toolbar&&(t.classList.add("fixed-position"),t.style.position="absolute",t.style.top="0",t.style.left="50%",t.style.transform="translateX(-50%)")}))})),i.addEventListener("blur",(t=>{n.toolbar&&t.relatedTarget&&!n.toolbar.contains(t.relatedTarget)&&o.resetToolbar()})),document.addEventListener("mouseup",(t=>{const e=t.target;(i.contains(e)||n.toolbar&&n.toolbar.contains(e))&&o.handleSelection(t)})),document.addEventListener("keyup",(t=>{const e=t.target;i.contains(e)&&(t.shiftKey||o.hasSelection())&&o.handleSelection(t)})),document.addEventListener("mousedown",(t=>{const e=t.target;i.contains(e)&&(s=!0)})),document.addEventListener("mouseup",(()=>{s=!1})),i.addEventListener("mouseenter",(t=>{(o.hasSelection()||s)&&o.handleSelection(t)})),i.addEventListener("mouseleave",(()=>{s&&(e.isVisible=!1,o.updateView())})),window.addEventListener("scroll",(()=>{if(o.hasSelection()){const t=window.getSelection();if(t&&t.rangeCount>0){const s=t.getRangeAt(0);if(i.contains(s.commonAncestorContainer)){const t=s.getBoundingClientRect();if(n.toolbar&&!n.toolbar.style.getPropertyValue("--toolbar-width")){const t=n.toolbar.getBoundingClientRect().width;n.toolbar.style.setProperty("--toolbar-width",`${t}px`),n.toolbar.classList.add("following-selection")}t.bottom<0||t.top>window.innerHeight?e.isVisible=!1:(e.isVisible=!0,e.selectionRect=t),o.updateView()}}}}),{passive:!0}),window.addEventListener("resize",(()=>{e.isVisible&&(e.resizeTimeout&&clearTimeout(e.resizeTimeout),e.resizeTimeout=window.setTimeout((()=>{e.selectionRange&&i.contains(e.selectionRange.commonAncestorContainer)&&(e.selectionRect=e.selectionRange.getBoundingClientRect(),o.updatePosition())}),t.resizeDebounceMs))})),n.linkButton&&(n.linkButton.addEventListener("click",o.handleLinkButtonClick),n.saveLink?.addEventListener("click",o.handleSaveLinkClick),n.cancelLink?.addEventListener("click",o.handleCancelLinkClick),n.removeLink?.addEventListener("click",o.handleRemoveLinkClick),n.visitLink?.addEventListener("click",o.handleVisitLinkClick),n.linkInput?.addEventListener("input",o.handleLinkInputChange),n.linkInput?.addEventListener("keypress",(t=>{" "===t.key&&t.preventDefault()}))),n.toolbar&&n.toolbar.addEventListener("mousedown",(t=>{t.preventDefault(),t.stopPropagation()}));const l={bold:{element:n.boldButton,enabled:t.buttons.text?.bold},italic:{element:n.italicButton,enabled:t.buttons.text?.italic},underline:{element:n.underlineButton,enabled:t.buttons.text?.underline},strikethrough:{element:n.strikethroughButton,enabled:t.buttons.text?.strikethrough},subscript:{element:n.subscriptButton,enabled:t.buttons.script?.subscript},superscript:{element:n.superscriptButton,enabled:t.buttons.script?.superscript},h1:{element:n.h1Button,enabled:t.buttons.heading?.h1},h2:{element:n.h2Button,enabled:t.buttons.heading?.h2},dropCap:{element:n.dropCapButton,enabled:t.buttons.special?.dropCap},code:{element:n.codeButton,enabled:t.buttons.special?.code},quote:{element:n.quoteButton,enabled:t.buttons.special?.quote},hr:{element:n.hrButton,enabled:t.buttons.special?.hr},bulletList:{element:n.bulletListButton,enabled:t.buttons.list?.bullet},numberList:{element:n.numberListButton,enabled:t.buttons.list?.number}};Object.entries(l).forEach((([t,e])=>{e.enabled&&e.element&&e.element.addEventListener("click",(()=>o.handleFormat(t)))}))}(this.config,this.state,this.elements,{handleSelection:this.handleSelection.bind(this),handleFormat:this.handleFormat.bind(this),handleLinkButtonClick:this.handleLinkButtonClick.bind(this),handleSaveLinkClick:this.handleSaveLinkClick.bind(this),handleCancelLinkClick:this.handleCancelLinkClick.bind(this),handleRemoveLinkClick:this.handleRemoveLinkClick.bind(this),handleVisitLinkClick:this.handleVisitLinkClick.bind(this),handleLinkInputChange:this.handleLinkInputChange.bind(this),hasSelection:this.hasSelection.bind(this),updateView:this.updateView.bind(this),updatePosition:this.updatePosition.bind(this),resetToolbar:this.resetToolbar.bind(this)}),this.elements.toolbar&&(this.elements.toolbar.classList.add("floating-toolbar"),this.elements.toolbar.classList.toggle("fixed-position",this.state.isFixed),this.elements.toolbar.classList.add(`theme-${this.config.theme}`),this.elements.toolbar.offsetHeight),this.debug("Selection state:",{isVisible:this.state.isVisible,selectionRect:this.state.selectionRect,selectedText:this.state.selectedText}),this.updateView()}function i(t){const e=document.querySelector(this.config.selector||this.config.content);if(!e)return;if(this.debug("Handling selection for toolbar",{toolbarId:this.config.toolbarId,contentSelector:this.config.selector||this.config.content,isFixed:this.state.isFixed,allToolbars:Array.from(document.querySelectorAll(".floating-toolbar")).map((t=>t.id))}),"type"in t&&"mouseup"===t.type&&e.contains(t.target)){const t=this.elements.toolbar?.getBoundingClientRect().width;t&&this.elements.toolbar&&this.elements.toolbar.style.setProperty("--toolbar-width",`${t}px`),document.querySelectorAll(".floating-toolbar").forEach((t=>{this.debug("Found toolbar during reset",{toolbarId:t.id,isCurrentToolbar:t===this.elements.toolbar,classList:Array.from(t.classList)}),t!==this.elements.toolbar&&(t.classList.add("fixed-position"),t.style.position="absolute",t.style.top="0",t.style.left="50%",t.style.transform="translateX(-50%)")}))}if(this.elements.toolbar&&"type"in t&&"mouseup"===t.type&&this.elements.toolbar.contains(t.target))return;if(this.state.isProcessingLinkClick)return void this.debug("Ignoring selection event during link processing");const n=window.getSelection();if(!n)return;const o=n.toString().trim();if("type"in t&&"mouseup"===t.type&&this.elements.toolbar&&!this.elements.toolbar.contains(t.target)&&!e.contains(t.target))return this.state.currentSelection=null,this.state.selectedText="",this.state.selectionRange=null,this.state.isVisible=this.state.isFixed,this.state.existingLink=null,this.state.currentView="initial",this.clearFormatButtonStates(),this.elements.toolbar&&(this.elements.toolbar.style.removeProperty("--toolbar-width"),this.elements.toolbar.classList.remove("following-selection")),void this.updateView();if(o&&n.rangeCount>0){const t=n.getRangeAt(0);if(!e.contains(t.commonAncestorContainer))return;if(this.elements.toolbar&&!this.elements.toolbar.style.getPropertyValue("--toolbar-width")){const t=this.elements.toolbar.getBoundingClientRect().width;this.elements.toolbar.style.setProperty("--toolbar-width",`${t}px`)}this.state.selectionRect=t.getBoundingClientRect(),this.state.currentSelection=n,this.state.selectedText=o,this.state.selectionRange=t.cloneRange(),this.state.isVisible=!0;const i=this.checkForExistingLink(n);i?(this.state.existingLink=i,this.state.currentView="linkInput",this.elements.linkInput&&(this.elements.linkInput.value=i.href)):(this.state.existingLink=null,this.state.currentView="initial",this.elements.linkInput&&(this.elements.linkInput.value="")),this.elements.toolbar&&this.elements.toolbar.classList.add("following-selection")}else this.elements.toolbar&&!this.elements.toolbar.contains(t.target)&&(this.state.currentSelection=null,this.state.selectedText="",this.state.selectionRange=n.rangeCount>0?n.getRangeAt(0).cloneRange():null,this.state.isVisible=this.state.isFixed,this.state.existingLink=null,this.state.isProcessingLinkClick||(this.state.currentView="initial"),this.elements.toolbar&&(this.elements.toolbar.style.removeProperty("--toolbar-width"),this.elements.toolbar.classList.remove("following-selection")));this.updateFormatButtonStates(),this.updateView()}function s(){const t=window.getSelection();if(!t||!t.toString().trim().length)return!1;const e=document.querySelector(this.config.selector||this.config.content);if(!e)return!1;if(t.rangeCount>0){const n=t.getRangeAt(0);return e.contains(n.commonAncestorContainer)}return!1}function l(t){t.preventDefault(),t.stopPropagation(),this.state.isProcessingLinkClick=!0;const e=this.elements.toolbar?.getBoundingClientRect().width,n=window.getSelection();if(n){const t=b.call(this,n);t?(this.state.existingLink=t,this.elements.linkInput&&(this.elements.linkInput.value=t.href)):(this.state.existingLink=null,this.elements.linkInput&&(this.elements.linkInput.value=""))}this.state.currentView="linkInput",this.updateView(),requestAnimationFrame((()=>{try{if("linkInput"===this.state.currentView&&this.elements.linkInput){this.elements.linkInput.style.display="flex",this.elements.linkInput.disabled=!1,this.elements.linkInput.style.pointerEvents="auto",setTimeout((()=>{this.elements.linkInput&&(this.elements.linkInput.disabled=!1,this.elements.linkInput.style.pointerEvents="auto",this.elements.linkInput.focus(),this.elements.linkInput.value&&this.elements.linkInput.select())}),0);const t=250,n=32,o=this.state.existingLink?4:3,i=t+n*o+8+4*(o+1),s=Math.max(i,Math.min(e||0,450));this.elements.toolbar&&this.elements.toolbar.style.setProperty("--toolbar-width",`${s}px`),this.debug("Link input view shown, input focused")}else this.debug("View state changed before input could be focused")}finally{setTimeout((()=>{this.state.isProcessingLinkClick=!1}),0)}}))}function a(t){if(t.preventDefault(),t.stopPropagation(),!this.elements.linkInput)return;const e=this.elements.linkInput.value.trim();if(e&&this.state.selectedText&&this.state.selectionRange){this.debug("User has saved the link",e),this.debug("Selected text",this.state.selectedText);try{if(this.state.existingLink)this.state.existingLink.href=window.ensureValidUrl(e),this.debug("Updated existing link",this.state.existingLink.outerHTML);else{const t=document.createElement("a");t.href=window.ensureValidUrl(e),t.target="_blank",t.rel="noopener noreferrer",t.textContent=this.state.selectedText;const n=this.state.selectionRange;n.deleteContents(),n.insertNode(t),t.parentNode&&t.parentNode.normalize(),this.debug("Created new link",t.outerHTML)}window.getSelection()?.removeAllRanges(),this.state.isVisible=!1,this.state.currentSelection=null,this.state.selectedText="",this.state.selectionRange=null,this.state.selectionRect=null,this.state.existingLink=null,this.elements.linkInput.value="",this.state.currentView="initial",this.updateView()}catch(t){console.error("Error handling link:",t),console.error("Error details:",{selectedText:this.state.selectedText,range:this.state.selectionRange,existingLink:this.state.existingLink,error:t.message})}}else this.debug("No URL or selection available",{url:e,selectedText:this.state.selectedText,hasRange:Boolean(this.state.selectionRange),existingLink:this.state.existingLink})}function r(t){t.preventDefault(),t.stopPropagation(),this.state.currentView="initial",this.elements.linkInput&&(this.elements.linkInput.value=""),this.elements.toolbar&&this.elements.toolbar.style.removeProperty("--toolbar-width"),this.updateView()}function c(t){if(t.preventDefault(),t.stopPropagation(),this.state.existingLink&&this.state.selectionRange)try{const t=this.state.existingLink.textContent,e=document.createTextNode(t||"");this.state.existingLink.parentNode?.replaceChild(e,this.state.existingLink),this.debug("Removed link, preserved text",t),window.getSelection()?.removeAllRanges(),this.state.isVisible=!1,this.state.currentSelection=null,this.state.selectedText="",this.state.selectionRange=null,this.state.selectionRect=null,this.state.existingLink=null,this.elements.linkInput&&(this.elements.linkInput.value=""),this.state.currentView="initial",this.updateView()}catch(t){console.error("Error removing link:",t)}}function u(t){const e=t.target.value.trim();h.call(this,e)}function d(t){if(t.preventDefault(),t.stopPropagation(),!this.elements.linkInput)return;const e=this.elements.linkInput.value.trim();if(window.isValidUrl(e)){const t=window.ensureValidUrl(e);window.open(t,"_blank","noopener,noreferrer")}}function h(t){if(this.elements.visitLink){const e=window.isValidUrl(t);this.elements.visitLink.style.display=e?"flex":"none",this.debug(`Visit button visibility updated: ${e}`,{url:t})}}function b(t){if(0===t.rangeCount)return null;const e=t.getRangeAt(0).commonAncestorContainer,n=e.nodeType===Node.TEXT_NODE?e.parentElement:e;return"A"===n?.tagName?n:window.findClosestLink(n)}function p(t){if(!this.state.selectionRange)return;let e;switch(t){case"bold":e="bold";break;case"italic":e="italic";break;case"underline":e="underline";break;case"strikethrough":e="strikeThrough";break;case"subscript":e="subscript";break;case"superscript":e="superscript";break;case"h1":case"h2":return void m.call(this,t);case"dropCap":return void g.call(this);case"code":return void f.call(this);case"quote":return void k.call(this);case"hr":return void v.call(this);case"bulletList":e="insertUnorderedList";break;case"numberList":e="insertOrderedList";break;default:return}try{const n=window.getSelection();if(!n)return;n.removeAllRanges(),n.addRange(this.state.selectionRange),document.execCommand(e,!1,""),w.call(this),this.state.selectionRange=n.getRangeAt(0).cloneRange(),this.state.selectionRect=this.state.selectionRange.getBoundingClientRect(),this.state.isVisible=!0,this.updateView(),this.debug(`Applied ${t} formatting`)}catch(e){console.error(`Error applying ${t} format:`,e)}}function m(t){const e=window.getSelection();if(!e||!this.state.selectionRange)return;e.removeAllRanges(),e.addRange(this.state.selectionRange);const n=e.getRangeAt(0).commonAncestorContainer,o=3===n.nodeType?n.parentElement:n;if(!o)return;o.closest(`h${t.slice(-1)}`)?document.execCommand("formatBlock",!1,"P"):document.execCommand("formatBlock",!1,t.toUpperCase());const i=window.getSelection();i&&(this.state.selectionRange=i.getRangeAt(0).cloneRange(),this.state.selectionRect=this.state.selectionRange.getBoundingClientRect(),w.call(this))}function g(){const t=window.getSelection();if(!t||!this.state.selectionRange)return;t.removeAllRanges(),t.addRange(this.state.selectionRange);let e=t.getRangeAt(0).commonAncestorContainer;for(;e&&(1!==e.nodeType||!["P","DIV"].includes(e.tagName));){const t=e.parentNode;if(!t)break;e=t}if(!e)return;const n=e;n.classList.contains("drop-cap")?(n.classList.remove("drop-cap"),this.state.dropCapElements.delete(n)):(n.classList.add("drop-cap"),this.state.dropCapElements.add(n)),w.call(this)}function f(){const t=window.getSelection();if(!t||!this.state.selectionRange)return;t.removeAllRanges(),t.addRange(this.state.selectionRange);const e=t.getRangeAt(0),n=t=>{for(;t&&t.nodeType;){if(1===t.nodeType){const e=t;if("CODE"===e.tagName)return e;const n=e.getElementsByTagName("code");if(n.length>0)return n[0]}t=t.parentNode}return null},o=e.startContainer,i=e.endContainer,s=n(o)||n(i);if(this.debug("Code button clicked. Current state",{startContainer:o,endContainer:i,hasCodeElement:!!s,selectedText:t.toString()}),s){this.debug("Removing code formatting from",{element:s,content:s.textContent});const e=s.textContent,n=s.parentNode;if(!n)return;const o=document.createTextNode(e||"");n.replaceChild(o,s);const i=document.createRange();i.setStart(o,0),i.setEnd(o,o.length),t.removeAllRanges(),t.addRange(i),this.state.selectionRange=i.cloneRange()}else{this.debug("Adding code formatting to",{selectedText:t.toString()});const n=document.createElement("code");e.surroundContents(n);const o=document.createRange();o.selectNode(n),t.removeAllRanges(),t.addRange(o),this.state.selectionRange=o.cloneRange()}w.call(this)}function k(){const t=window.getSelection();if(!t||!this.state.selectionRange)return;t.removeAllRanges(),t.addRange(this.state.selectionRange);const e=t.getRangeAt(0).commonAncestorContainer,n=3===e.nodeType?e.parentElement:e;if(!n)return;const o=n.closest("blockquote");if(o){const t=document.createDocumentFragment();for(;o.firstChild;)t.appendChild(o.firstChild);o.parentNode?.replaceChild(t,o),t.querySelectorAll("div").forEach((t=>{const e=document.createElement("p");e.innerHTML=t.innerHTML,t.parentNode?.replaceChild(e,t)})),n.normalize()}else document.execCommand("formatBlock",!1,"BLOCKQUOTE");const i=window.getSelection();i&&(this.state.selectionRange=i.getRangeAt(0).cloneRange(),w.call(this))}function v(){const t=window.getSelection();if(!t||!this.state.selectionRange)return;t.removeAllRanges(),t.addRange(this.state.selectionRange);const e=document.createElement("hr");let n=t.getRangeAt(0).commonAncestorContainer;for(;n&&3===n.nodeType;){const t=n.parentNode;if(!t)break;n=t}if(n&&n.parentNode){n.parentNode.insertBefore(e,n.nextSibling);const o=document.createElement("p");o.innerHTML="<br>",n.parentNode.insertBefore(o,e.nextSibling);const i=document.createRange();i.setStart(o,0),i.setEnd(o,0),t.removeAllRanges(),t.addRange(i),this.state.isVisible=!1,this.state.selectionRange=null,this.state.selectionRect=null,this.updateView()}}function w(){const t=window.getSelection();if(!t||!t.rangeCount)return;const e=t.getRangeAt(0).commonAncestorContainer,n=3===e.nodeType?e.parentElement:e;if(!n)return;const o={bold:this.elements.boldButton,italic:this.elements.italicButton,underline:this.elements.underlineButton,strikethrough:this.elements.strikethroughButton,subscript:this.elements.subscriptButton,superscript:this.elements.superscriptButton,insertUnorderedList:this.elements.bulletListButton,insertOrderedList:this.elements.numberListButton};for(const[t,e]of Object.entries(o))e&&(document.queryCommandState(t)?(e.classList.add("active"),this.state.activeFormats.add(t)):(e.classList.remove("active"),this.state.activeFormats.delete(t)));this.elements.h1Button&&this.elements.h1Button.classList.toggle("active",!!n.closest("h1")),this.elements.h2Button&&this.elements.h2Button.classList.toggle("active",!!n.closest("h2")),this.elements.codeButton&&this.elements.codeButton.classList.toggle("active",!!n.closest("code")),this.elements.quoteButton&&this.elements.quoteButton.classList.toggle("active",!!n.closest("blockquote")),this.elements.dropCapButton&&this.elements.dropCapButton.classList.toggle("active",this.state.dropCapElements.has(n))}function L(){const t={bold:this.elements.boldButton,italic:this.elements.italicButton,underline:this.elements.underlineButton,strikethrough:this.elements.strikethroughButton,subscript:this.elements.subscriptButton,superscript:this.elements.superscriptButton,insertUnorderedList:this.elements.bulletListButton,insertOrderedList:this.elements.numberListButton};for(const e of Object.values(t))e&&e.classList.remove("active");this.elements.h1Button&&this.elements.h1Button.classList.remove("active"),this.elements.h2Button&&this.elements.h2Button.classList.remove("active"),this.elements.codeButton&&this.elements.codeButton.classList.remove("active"),this.elements.quoteButton&&this.elements.quoteButton.classList.remove("active"),this.elements.dropCapButton&&this.elements.dropCapButton.classList.remove("active"),this.state.activeFormats.clear()}t.r(e),t.d(e,{FloatingToolbar:()=>x,default:()=>B});class x{constructor(t={},{addRequiredStyles:e,addToolbarStyles:m}={}){this.addRequiredStyles=e||(()=>{}),this.addToolbarStyles=m||(()=>{});const g={container:".content-wrapper",content:".content",mode:"floating",theme:"dark",debug:!1,useExistingToolbar:!1,buttons:{text:{bold:!0,italic:!0,underline:!0,strikethrough:!0},script:{subscript:!0,superscript:!0},heading:{h1:!0,h2:!0},special:{dropCap:!0,code:!0,quote:!0,hr:!0},list:{bullet:!0,number:!0},link:{url:!0}},offset:{x:0,y:10},fixedPosition:{top:0,center:!0},toolbarId:"floating-toolbar",resizeDebounceMs:150,selector:".content"};this.config={...g,...t,selector:t.content||t.selector||g.selector,toolbarId:t.toolbarId||g.toolbarId,resizeDebounceMs:t.resizeDebounceMs||g.resizeDebounceMs},this.state={isVisible:"fixed"===this.config.mode,currentView:"initial",currentSelection:null,selectedText:"",selectionRange:null,position:{x:0,y:0},selectionRect:null,existingLink:null,resizeTimeout:null,activeFormats:new Set,dropCapElements:new Set,isProcessingLinkClick:!1,isFixed:"fixed"===this.config.mode,isAtFixedPosition:!0},this.elements={toolbar:null,toolbarInitial:null,toolbarLinkInput:null,linkButton:null,linkInput:null,saveLink:null,cancelLink:null,removeLink:null,visitLink:null,boldButton:null,italicButton:null,underlineButton:null,strikethroughButton:null,subscriptButton:null,superscriptButton:null,h1Button:null,h2Button:null,dropCapButton:null,codeButton:null,quoteButton:null,hrButton:null,bulletListButton:null,numberListButton:null},this.handleSelection=i.bind(this),this.handleLinkButtonClick=l.bind(this),this.handleSaveLinkClick=a.bind(this),this.handleCancelLinkClick=r.bind(this),this.handleRemoveLinkClick=c.bind(this),this.handleLinkInputChange=u.bind(this),this.handleVisitLinkClick=d.bind(this),this.handleFormat=p.bind(this),this.hasSelection=s.bind(this),this.updateVisitButton=h.bind(this),this.updateFormatButtonStates=w.bind(this),this.clearFormatButtonStates=L.bind(this),this.updateView=n.bind(this),this.checkForExistingLink=b.bind(this),this.initialize=o.bind(this),this.resetToolbar=()=>function(t,e,n){t.isFixed&&e.toolbar&&(t.isVisible=!0,t.currentView="initial",t.isAtFixedPosition=!0,e.toolbar.classList.add("fixed-position"),e.toolbar.classList.remove("following-selection"),e.toolbar.classList.remove("below"),e.toolbar.style.position="absolute",e.toolbar.style.top="0",e.toolbar.style.left="50%",e.toolbar.style.transform="translateX(-50%)",n())}(this.state,this.elements,this.clearFormatButtonStates);const f=document.querySelector(this.config.selector);f?(function(t,e,n,o){if(e.useExistingToolbar){let n=t.closest(".content-wrapper");n||(n=document.createElement("div"),n.className="content-wrapper",t.parentNode&&(t.parentNode.insertBefore(n,t),n.appendChild(t)));const o=e.container||".content-wrapper",i=document.querySelector(o);if(!i||!i.querySelector(".toolbar-container"))return void console.error("FloatingToolbar: Existing toolbar container not found")}else{let o=t.closest(".content-wrapper");o||(o=document.createElement("div"),o.className="content-wrapper",t.parentNode&&(t.parentNode.insertBefore(o,t),o.appendChild(t)));let i=o.querySelector(".toolbar-container");i||(i=document.createElement("div"),i.className="toolbar-container",o.insertBefore(i,o.firstChild)),i.innerHTML=function(t,e){const n=t.theme?`theme-${t.theme}`:"theme-dark";return`\n        <div id="${t.toolbarId}" class="floating-toolbar ${e.isFixed?"fixed-position":""} ${n}">\n            <div class="toolbar-initial">\n                \x3c!-- Text formatting group --\x3e\n                <div class="toolbar-group">\n                    ${t.buttons.text.bold?`\n                        <button id="${t.toolbarId}-bold-button" title="Bold">\n                            <span class="material-icons" data-icon="format_bold">format_bold</span>\n                        </button>\n                    `:""}\n                    ${t.buttons.text.italic?`\n                        <button id="${t.toolbarId}-italic-button" title="Italic">\n                            <span class="material-icons" data-icon="format_italic">format_italic</span>\n                        </button>\n                    `:""}\n                    ${t.buttons.text.underline?`\n                        <button id="${t.toolbarId}-underline-button" title="Underline">\n                            <span class="material-icons" data-icon="format_underline">format_underline</span>\n                        </button>\n                    `:""}\n                    ${t.buttons.text.strikethrough?`\n                        <button id="${t.toolbarId}-strikethrough-button" title="Strikethrough">\n                            <span class="material-icons" data-icon="format_strikethrough">format_strikethrough</span>\n                        </button>\n                    `:""}\n                </div>\n                \n                \x3c!-- Headings group --\x3e\n                ${t.buttons.heading?.h1||t.buttons.heading?.h2?`\n                    <div class="toolbar-group">\n                        ${t.buttons.heading?.h1?`\n                            <button id="${t.toolbarId}-h1-button" title="Heading 1">\n                                <span class="material-icons" data-icon="looks_one">looks_one</span>\n                            </button>\n                        `:""}\n                        ${t.buttons.heading?.h2?`\n                            <button id="${t.toolbarId}-h2-button" title="Heading 2">\n                                <span class="material-icons" data-icon="looks_two">looks_two</span>\n                            </button>\n                        `:""}\n                    </div>\n                `:""}\n                \n                \x3c!-- Special formatting group --\x3e\n                ${t.buttons.special?.code||t.buttons.special?.quote||t.buttons.special?.dropCap||t.buttons.special?.hr?`\n                    <div class="toolbar-group">\n                        ${t.buttons.special?.code?`\n                            <button id="${t.toolbarId}-code-button" title="Code">\n                                <span class="material-icons" data-icon="code">code</span>\n                            </button>\n                        `:""}\n                        ${t.buttons.special?.quote?`\n                            <button id="${t.toolbarId}-quote-button" title="Quote">\n                                <span class="material-icons" data-icon="format_quote">format_quote</span>\n                            </button>\n                        `:""}\n                        ${t.buttons.special?.dropCap?`\n                            <button id="${t.toolbarId}-drop-cap-button" title="Drop Cap">\n                                <span class="material-icons" data-icon="format_size">format_size</span>\n                            </button>\n                        `:""}\n                        ${t.buttons.special?.hr?`\n                            <button id="${t.toolbarId}-hr-button" title="Horizontal Rule">\n                                <span class="material-icons" data-icon="horizontal_rule">horizontal_rule</span>\n                            </button>\n                        `:""}\n                    </div>\n                `:""}\n\n                \x3c!-- List formatting group --\x3e\n                ${t.buttons.list?.bullet||t.buttons.list?.number?`\n                    <div class="toolbar-group">\n                        ${t.buttons.list?.bullet?`\n                            <button id="${t.toolbarId}-bullet-list-button" title="Bullet List">\n                                <span class="material-icons" data-icon="format_list_bulleted">format_list_bulleted</span>\n                            </button>\n                        `:""}\n                        ${t.buttons.list?.number?`\n                            <button id="${t.toolbarId}-number-list-button" title="Numbered List">\n                                <span class="material-icons" data-icon="format_list_numbered">format_list_numbered</span>\n                            </button>\n                        `:""}\n                    </div>\n                `:""}\n\n                \x3c!-- Link group --\x3e\n                ${t.buttons.link?.url?`\n                    <div class="toolbar-group">\n                        <button id="${t.toolbarId}-link-button" title="Add Link">\n                            <span class="material-icons" data-icon="link">link</span>\n                        </button>\n                    </div>\n                `:""}\n            </div>\n            <div class="toolbar-link-input">\n                <input type="text" id="${t.toolbarId}-link-input" placeholder="Enter URL...">\n                <button id="${t.toolbarId}-visit-link" class="toolbar-button" type="button" title="Visit URL">\n                    <span class="material-icons" data-icon="open_in_new">open_in_new</span>\n                </button>\n                <button id="${t.toolbarId}-remove-link" class="toolbar-button" type="button" title="Remove link">\n                    <span class="material-icons" data-icon="delete">delete</span>\n                </button>\n                <button id="${t.toolbarId}-save-link" class="toolbar-button" type="button" title="Save">\n                    <span class="material-icons" data-icon="check">check</span>\n                </button>\n                <button id="${t.toolbarId}-cancel-link" class="toolbar-button" type="button" title="Cancel">\n                    <span class="material-icons" data-icon="close">close</span>\n                </button>\n            </div>\n        </div>\n    `}(e,n)}t.classList.add("content"),t.hasAttribute("contenteditable")||t.setAttribute("contenteditable","true"),o()}(f,this.config,this.state,this.addRequiredStyles),this.initialize()):console.error(`FloatingToolbar: Target element with selector "${this.config.selector}" not found`)}updatePosition(){var t,e,n,o;t=this.config,e=this.state,n=this.elements,o=this.debug.bind(this),n.toolbar&&(e.isFixed?function(t,e,n,o){if(!n.toolbar)return;const i=document.getSelection(),s=!!i&&i.toString().trim().length>0,l=document.querySelector(t.selector||""),a=n.toolbar.closest(".toolbar-container"),r=n.toolbar.closest(".content-wrapper");r&&l&&a?s?e.selectionRect&&function(t,e,n,o,i,s,l){if(!n.toolbar||!e.selectionRect)return;const a=n.toolbar.offsetWidth;n.toolbar.style.setProperty("--toolbar-width",`${a}px`);const r=e.selectionRect,c=n.toolbar.getBoundingClientRect(),u=i.getBoundingClientRect(),d=s.getBoundingClientRect();l("Viewport and Window Measurements",{window:{innerHeight:window.innerHeight,innerWidth:window.innerWidth,scrollY:window.scrollY,pageYOffset:window.pageYOffset},viewport:{top:0,bottom:window.innerHeight,visualTop:window.visualViewport?.offsetTop||0,visualHeight:window.visualViewport?.height||window.innerHeight},contentArea:{rect:o.getBoundingClientRect(),offsetTop:o.offsetTop,offsetHeight:o.offsetHeight,scrollTop:o.scrollTop},container:{rect:d,offsetTop:s.offsetTop,offsetHeight:s.offsetHeight,scrollTop:s.scrollTop},toolbar:{rect:n.toolbar.getBoundingClientRect(),offsetTop:n.toolbar.offsetTop,offsetHeight:n.toolbar.offsetHeight}}),l("Detailed Space Calculations",{selectionTopFromViewport:r.top,selectionBottomFromViewport:r.bottom,toolbarTotalHeight:c.height+t.offset.y,viewportHeight:window.innerHeight,visualViewportHeight:window.visualViewport?.height||window.innerHeight,spaceAboveSelection:r.top,spaceBelowSelection:window.innerHeight-r.bottom,containerTopOffset:u.top,containerBottomOffset:u.bottom});const h=r.top,b=(window.innerHeight,r.bottom,h<c.height+t.offset.y);let p=r.left+r.width/2-d.left;const m=a/2,g=d.width-a/2;p=Math.max(m,Math.min(p,g)),l("Fixed Mode: Horizontal positioning",{originalLeft:r.left+r.width/2-d.left,constrainedLeft:p,bounds:{min:m,max:g},containerWidth:d.width});const f=p-a/2,k=b?r.top-d.top+r.height+t.offset.y:r.top-d.top-c.height-t.offset.y;l("Fixed Mode: Final position",{top:k,relativeLeft:f,shouldPositionBelow:b,isFollowingSelection:!0}),n.toolbar.classList.remove("fixed-position"),n.toolbar.classList.add("following-selection"),n.toolbar.classList.toggle("below",b),e.isAtFixedPosition=!1,n.toolbar.style.position="absolute",n.toolbar.style.top=`${k}px`,n.toolbar.style.left=`${f}px`,n.toolbar.style.transform="none"}(t,e,n,l,a,r,o):(o("Fixed Mode: No selection - resetting to default position",{isFixed:e.isFixed,isAtFixedPosition:e.isAtFixedPosition}),function(t,e){e.toolbar&&(e.toolbar.classList.add("fixed-position"),e.toolbar.classList.remove("following-selection"),e.toolbar.classList.remove("below"),t.isAtFixedPosition=!0,e.toolbar.style.position="absolute",e.toolbar.style.top="0",e.toolbar.style.left="50%",e.toolbar.style.transform="translateX(-50%)",e.toolbar.style.removeProperty("--toolbar-width"))}(e,n)):console.error("FloatingToolbar: Required elements not found")}(t,e,n,o):function(t,e,n){if(!e.selectionRect||!n.toolbar)return;const o=e.selectionRect,i=(window.innerWidth,window.innerHeight),s=n.toolbar.closest(".content-wrapper");if(!s)return void console.error("FloatingToolbar: Content wrapper not found");const l=s.getBoundingClientRect(),a=n.toolbar.getBoundingClientRect(),r=a.width,c=a.height;let u=o.top-l.top,d=o.left-l.left+o.width/2;const h=o.top,b=(o.bottom,h<c+t.offset.y),p=r/2,m=l.width-r/2;if(d=Math.max(p,Math.min(d,m)),n.toolbar.style.left=`${d}px`,b){let e=u+o.height+t.offset.y;o.bottom+c+t.offset.y>i&&(e=u-c-t.offset.y),n.toolbar.style.top=`${e}px`,n.toolbar.style.transform="translate(-50%, 0)"}else{let e=u-t.offset.y;o.top-c-t.offset.y<0&&(e=u+o.height+t.offset.y),n.toolbar.style.top=`${e}px`,n.toolbar.style.transform="translate(-50%, -100%)"}n.toolbar.classList.toggle("below",b),n.toolbar.classList.add("following-selection")}(t,e,n))}debug(...t){this.config.debug&&console.log("[FloatingToolbar]",...t)}}class y{static injectRequiredStyles(){this.injectStyles(this.REQUIRED_STYLES)}static injectToolbarStyles(){this.injectStyles(this.TOOLBAR_STYLES)}static cleanup(){[this.REQUIRED_STYLES.id,this.TOOLBAR_STYLES.id].forEach((t=>{const e=document.getElementById(t);e&&e.remove()}))}static injectStyles(t){if(!document.getElementById(t.id)){const e=document.createElement("style");e.id=t.id,e.textContent=t.css,document.head.appendChild(e)}}}y.REQUIRED_STYLES={id:"floating-toolbar-required-styles",css:"\n            .toolbar-container {\n                position: absolute;\n                width: 100%;\n                height: 0;\n                pointer-events: none;\n                left: 0;\n                top: 0;\n                z-index: 1000;\n            }\n            \n            .floating-toolbar {\n                pointer-events: auto;\n                position: absolute;\n                z-index: 1001;\n                transform: translate(-50%, 0);\n                margin-top: -10px;\n                visibility: hidden;\n                opacity: 0;\n                transition: opacity 0.2s ease, transform 0.2s ease;\n                display: flex;\n                align-items: center;\n                border-radius: 4px;\n                padding: 6px;\n                \n                /* Default dark theme */\n                --toolbar-bg: #2a2a2a;\n                --toolbar-text: #ffffff;\n                --toolbar-button-hover: rgba(255, 255, 255, 0.1);\n                --toolbar-button-active: rgba(255, 255, 255, 0.2);\n                --toolbar-divider: rgba(255, 255, 255, 0.2);\n                background-color: var(--toolbar-bg);\n                color: var(--toolbar-text);\n                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n            }\n\n            /* Light theme overrides */\n            .floating-toolbar.theme-light {\n                --toolbar-bg: #ffffff;\n                --toolbar-text: #333333;\n                --toolbar-button-hover: rgba(0, 0, 0, 0.05);\n                --toolbar-button-active: rgba(0, 0, 0, 0.1);\n                --toolbar-divider: rgba(0, 0, 0, 0.1);\n                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n                border: 1px solid #e1e1e1;\n            }\n\n            /* Custom theme support - use light theme as fallback */\n            .floating-toolbar.theme-custom {\n                --toolbar-bg: var(--custom-toolbar-bg, #ffffff);\n                --toolbar-text: var(--custom-toolbar-text, #333333);\n                --toolbar-button-hover: var(--custom-toolbar-button-hover, rgba(0, 0, 0, 0.05));\n                --toolbar-button-active: var(--custom-toolbar-button-active, rgba(0, 0, 0, 0.1));\n                --toolbar-divider: var(--custom-toolbar-divider, rgba(0, 0, 0, 0.1));\n                box-shadow: var(--toolbar-shadow, 0 2px 6px rgba(0, 0, 0, 0.1));\n                border: 1px solid var(--toolbar-border, #e1e1e1);\n            }\n\n            .floating-toolbar.visible {\n                visibility: visible;\n                opacity: 1;\n            }\n\n            .floating-toolbar::after {\n                content: '';\n                position: absolute;\n                left: 50%;\n                transform: translateX(-50%);\n                width: 0;\n                height: 0;\n                border-left: 6px solid transparent;\n                border-right: 6px solid transparent;\n                border-top: 6px solid var(--toolbar-bg);\n                bottom: -6px;\n            }\n\n            .floating-toolbar.below::after {\n                border-top: none;\n                border-bottom: 6px solid var(--toolbar-bg);\n                bottom: auto;\n                top: -6px;\n            }\n\n            .floating-toolbar button {\n                background: none;\n                border: none;\n                color: inherit;\n                padding: 4px;\n                margin: 0 2px;\n                cursor: pointer;\n                border-radius: 3px;\n                transition: background-color 0.2s ease;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .floating-toolbar button:hover {\n                background-color: var(--toolbar-button-hover);\n            }\n\n            .floating-toolbar button.active {\n                background-color: var(--toolbar-button-active);\n            }\n\n            .floating-toolbar button:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n\n            .floating-toolbar .material-icons {\n                font-size: 18px;\n            }\n\n            .floating-toolbar .divider {\n                width: 1px;\n                height: 24px;\n                background-color: var(--toolbar-divider);\n                margin: 0 4px;\n            }\n\n            .floating-toolbar .toolbar-initial {\n                display: flex;\n                align-items: center;\n            }\n\n            .floating-toolbar .toolbar-group {\n                display: flex;\n                align-items: center;\n                margin: 0 4px;\n            }\n\n            /* Group separators for default and light themes */\n            .floating-toolbar:not(.theme-custom) .toolbar-group:not(:last-child)::after {\n                content: '';\n                width: 1px;\n                height: 24px;\n                background-color: var(--toolbar-divider);\n                margin: 0 4px;\n            }\n\n            .floating-toolbar .toolbar-group + .toolbar-group {\n                margin-left: 8px;\n            }\n\n            .floating-toolbar .toolbar-link-input {\n                display: none;\n                align-items: center;\n                padding: 0 4px;\n            }\n\n            .floating-toolbar .toolbar-link-input.active {\n                display: flex;\n            }\n\n            .floating-toolbar .toolbar-link-input input {\n                background: none;\n                border: none;\n                color: inherit;\n                outline: none;\n                padding: 4px;\n                min-width: 200px;\n            }\n\n            .floating-toolbar .toolbar-link-input input::placeholder {\n                color: inherit;\n                opacity: 0.5;\n            }\n        "},y.TOOLBAR_STYLES={id:"floating-toolbar-styles",css:""},window.findClosestLink=function t(e){return e?e instanceof HTMLAnchorElement?e:e instanceof HTMLElement?e.closest("a"):t(e.parentNode):null},window.isValidUrl=function(t){if(!t||"http://"===t||"https://"===t)return!1;try{return new URL(t).hostname.length>0}catch{try{return new URL(`http://${t}`).hostname.length>0}catch{return!1}}},window.ensureValidUrl=function(t){if(!t)return"";try{return new URL(t),t}catch{try{return new URL(`http://${t}`),`http://${t}`}catch{return""}}},y.injectRequiredStyles(),y.injectToolbarStyles();const B=x;return e})()));